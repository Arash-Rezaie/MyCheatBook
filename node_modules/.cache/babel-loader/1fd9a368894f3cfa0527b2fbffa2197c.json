{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _classCallCheck from\"/media/arash/SanDisk/MyCheatBook/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/media/arash/SanDisk/MyCheatBook/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/media/arash/SanDisk/MyCheatBook/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/media/arash/SanDisk/MyCheatBook/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/media/arash/SanDisk/MyCheatBook/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from\"react\";import{createPopper}from'@popperjs/core';import{EventDispatcher,Events}from\"../tools/event-dispatcher\";var PopupHandler=/*#__PURE__*/function(_React$Component){_inherits(PopupHandler,_React$Component);var _super=_createSuper(PopupHandler);function PopupHandler(props){var _this;_classCallCheck(this,PopupHandler);_this=_super.call(this,props);_this.state={items:[]};PopupHandler.instance=_assertThisInitialized(_this);_this.shouldUpdate=false;return _this;}/**\n     *\n     * @param name this name must be unique\n     * @param anchor element | 'cursor' | {getBoundingClientRect: ()=>{some rect}}\n     * @param content the popup jsx which you wanna show\n     * @param options popper options + the following:\n     * <p>\n     *     fields:<br>\n     *     arrow: [true | false]: to show an arrow. declare 'modifiers: [{name: 'offset', options: {offset: [5, 5],},},]' to place your content as you wish<br>\n     *     className: the css class name of yours<br>\n     *     hideOnClick: [true | false]: to hide when user clicks anywhere<br>\n     *     interactive: [true | false]: to hide when cursor moves outside automatically<br>\n     * </p>\n     * <br>\n     * <p>\n     *     methods:<br>\n     *     onHideListener: method to be called on hide<br>\n     *     onClickOutSide: method to be called on outside click<br>\n     * </p>\n     */_createClass(PopupHandler,[{key:\"show\",value:function show(name,anchor,content,options){var a=this.state.items;if(!a[name]){a[name]={name:name,anchor:anchor,reference:undefined,content:content,options:options,r:/*#__PURE__*/React.createRef(),isVisible:false,isProcessed:false,popper:undefined,eventDispatcher:undefined};}else{var t=a[name];t.anchor=anchor;t.content=content;t.options=options;t.isProcessed=false;}this.setState({items:a});this.shouldUpdate=true;}},{key:\"hide\",value:function hide(name){if(this.state.items[name]){var temp=this.state.items;var item=temp[name];delete temp[name];if(item.eventDispatcher!==undefined){this.clearEventDispatcher(item);}if(item.options&&item.options.onHideListener){item.options.onHideListener();}this.shouldUpdate=true;this.setState({items:temp});}}},{key:\"shouldComponentUpdate\",value:function shouldComponentUpdate(nextProps,nextState,nextContext){return this.shouldUpdate;}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps,prevState,snapshot){var i;for(i in this.state.items){i=prevState.items[i];if(!i.isProcessed){var readyToShow=this.prepare(i);if(!i.popper){i.popper=createPopper(i.reference,i.r.current,i.options);if(readyToShow)this.visible(i);}else{i.popper.update();}i.isProcessed=true;}}}},{key:\"prepare\",value:function prepare(item){var readyToShow=true;item.reference=item.anchor;if(item.reference==='cursor'){this.trackMousePointer(item);readyToShow=false;}if(item.options){if(item.options.onClickOutside||item.options.hideOnClick)this.handleOutsideClick(item);if(item.options.interactive)this.handleInteractive(item);}return readyToShow;}},{key:\"trackMousePointer\",value:function trackMousePointer(item){var _this2=this;var rect={width:5,height:5,top:0,right:5,bottom:5,left:0};item.reference={getBoundingClientRect:function getBoundingClientRect(){return rect;}};this.getEventDispatcher(item).register(Events.MOUSE_MOVE,function(_ref){var x=_ref.clientX,y=_ref.clientY;try{if(!item.isVisible)_this2.visible(item);rect.left=x;rect.top=y;rect.right=rect.left+rect.width;rect.bottom=rect.top+rect.height;item.popper.update();}catch(e){}});}},{key:\"handleOutsideClick\",value:function handleOutsideClick(item){var _this3=this;this.getEventDispatcher(item).register(Events.MOUSE_DOWN,function(_ref2){var x=_ref2.pageX,y=_ref2.pageY;try{if(item.options.onClickOutside){var rect=item.r.current.getBoundingClientRect();if(x<=rect.left||x>=rect.right||y<=rect.top||y>=rect.bottom)item.options.onClickOutside();}if(item.options.hideOnClick)_this3.hide(item.name);}catch(e){console.error(e);}});}},{key:\"handleInteractive\",value:function handleInteractive(item){var _this4=this;this.getEventDispatcher(item).register(Events.MOUSE_MOVE,function(_ref3){var x=_ref3.clientX,y=_ref3.clientY;try{var rect1=item.reference.getBoundingClientRect();var rect2=item.r.current.getBoundingClientRect();if(!item.interactiveOffset){var min=2;item.interactiveOffset=[min,min];try{item.interactiveOffset=item.options.modifiers.filter(function(h){return h.name==='offset';})[0].options.offset;if(item.interactiveOffset[0]===0)item.interactiveOffset[0]=min;if(item.interactiveOffset[1]===0)item.interactiveOffset[1]=min;}catch(e){}}var o=item.interactiveOffset;if(!(x>=rect1.left-o[1]&&x<=rect1.right+o[1]&&y>=rect1.top-o[0]&&y<=rect1.bottom+o[0]||x>=rect2.left-o[1]&&x<=rect2.right+o[1]&&y>=rect2.top-o[0]&&y<=rect2.bottom+o[0])){_this4.hide(item.name);}}catch(e){}});}},{key:\"getEventDispatcher\",value:function getEventDispatcher(item){if(!item.eventDispatcher)item.eventDispatcher=new EventDispatcher();return item.eventDispatcher;}},{key:\"clearEventDispatcher\",value:function clearEventDispatcher(item){item.eventDispatcher.unregister();item.eventDispatcher=undefined;}},{key:\"visible\",value:function visible(item){item.r.current.style.display='block';item.isVisible=true;}},{key:\"getItemsSJX\",value:function getItemsSJX(){var arr=[];var i;for(i in this.state.items){i=this.state.items[i];if(i.options&&i.options.arrow){var cls=void 0;if(i.options.className)cls=i.options.className;arr.push(/*#__PURE__*/_jsxs(\"div\",{ref:i.r,className:'popup-window '+cls,children:[/*#__PURE__*/_jsx(\"div\",{className:'arrow',\"data-popper-arrow\":true}),/*#__PURE__*/_jsx(\"div\",{className:'arrow-cover'}),i.content]},i.name));}else{arr.push(/*#__PURE__*/_jsx(\"div\",{ref:i.r,className:'popup-container',children:i.content},i.name));}}return arr;}},{key:\"render\",value:function render(){return this.getItemsSJX();}}],[{key:\"showPopup\",value:function showPopup(name,anchor,content,options){PopupHandler.instance.show(name,anchor,content,options);}},{key:\"hidePopup\",value:function hidePopup(name){PopupHandler.instance.hide(name);}}]);return PopupHandler;}(React.Component);export default PopupHandler;","map":{"version":3,"sources":["/media/arash/SanDisk/MyCheatBook/src/components/popup-handler.js"],"names":["React","createPopper","EventDispatcher","Events","PopupHandler","props","state","items","instance","shouldUpdate","name","anchor","content","options","a","reference","undefined","r","createRef","isVisible","isProcessed","popper","eventDispatcher","t","setState","temp","item","clearEventDispatcher","onHideListener","nextProps","nextState","nextContext","prevProps","prevState","snapshot","i","readyToShow","prepare","current","visible","update","trackMousePointer","onClickOutside","hideOnClick","handleOutsideClick","interactive","handleInteractive","rect","width","height","top","right","bottom","left","getBoundingClientRect","getEventDispatcher","register","MOUSE_MOVE","x","clientX","y","clientY","e","MOUSE_DOWN","pageX","pageY","hide","console","error","rect1","rect2","interactiveOffset","min","modifiers","filter","h","offset","o","unregister","style","display","arr","arrow","cls","className","push","getItemsSJX","show","Component"],"mappings":"upBAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAAQC,YAAR,KAA2B,gBAA3B,CACA,OAAQC,eAAR,CAAyBC,MAAzB,KAAsC,2BAAtC,C,GAEMC,CAAAA,Y,wHAGF,sBAAYC,KAAZ,CAAmB,8CACf,uBAAMA,KAAN,EACA,MAAKC,KAAL,CAAa,CAACC,KAAK,CAAE,EAAR,CAAb,CACAH,YAAY,CAACI,QAAb,+BACA,MAAKC,YAAL,CAAoB,KAApB,CAJe,aAKlB,CAED;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,O,2DASSC,I,CAAMC,M,CAAQC,O,CAASC,O,CAAS,CACjC,GAAIC,CAAAA,CAAC,CAAG,KAAKR,KAAL,CAAWC,KAAnB,CACA,GAAI,CAACO,CAAC,CAACJ,IAAD,CAAN,CAAc,CACVI,CAAC,CAACJ,IAAD,CAAD,CAAU,CACNA,IAAI,CAAEA,IADA,CAENC,MAAM,CAAEA,MAFF,CAGNI,SAAS,CAAEC,SAHL,CAINJ,OAAO,CAAEA,OAJH,CAKNC,OAAO,CAAEA,OALH,CAMNI,CAAC,cAAEjB,KAAK,CAACkB,SAAN,EANG,CAONC,SAAS,CAAE,KAPL,CAQNC,WAAW,CAAE,KARP,CASNC,MAAM,CAAEL,SATF,CAUNM,eAAe,CAAEN,SAVX,CAAV,CAYH,CAbD,IAaO,CACH,GAAIO,CAAAA,CAAC,CAAGT,CAAC,CAACJ,IAAD,CAAT,CACAa,CAAC,CAACZ,MAAF,CAAWA,MAAX,CACAY,CAAC,CAACX,OAAF,CAAYA,OAAZ,CACAW,CAAC,CAACV,OAAF,CAAYA,OAAZ,CACAU,CAAC,CAACH,WAAF,CAAgB,KAAhB,CACH,CACD,KAAKI,QAAL,CAAc,CAACjB,KAAK,CAAEO,CAAR,CAAd,EACA,KAAKL,YAAL,CAAoB,IAApB,CACH,C,kCAEIC,I,CAAM,CACP,GAAI,KAAKJ,KAAL,CAAWC,KAAX,CAAiBG,IAAjB,CAAJ,CAA4B,CACxB,GAAIe,CAAAA,IAAI,CAAG,KAAKnB,KAAL,CAAWC,KAAtB,CACA,GAAImB,CAAAA,IAAI,CAAGD,IAAI,CAACf,IAAD,CAAf,CACA,MAAOe,CAAAA,IAAI,CAACf,IAAD,CAAX,CAEA,GAAIgB,IAAI,CAACJ,eAAL,GAAyBN,SAA7B,CAAwC,CACpC,KAAKW,oBAAL,CAA0BD,IAA1B,EACH,CAED,GAAIA,IAAI,CAACb,OAAL,EAAgBa,IAAI,CAACb,OAAL,CAAae,cAAjC,CAAiD,CAC7CF,IAAI,CAACb,OAAL,CAAae,cAAb,GACH,CAED,KAAKnB,YAAL,CAAoB,IAApB,CACA,KAAKe,QAAL,CAAc,CAACjB,KAAK,CAAEkB,IAAR,CAAd,EACH,CACJ,C,oEAEqBI,S,CAAWC,S,CAAWC,W,CAAa,CACrD,MAAO,MAAKtB,YAAZ,CACH,C,8DAEkBuB,S,CAAWC,S,CAAWC,Q,CAAU,CAC/C,GAAIC,CAAAA,CAAJ,CACA,IAAKA,CAAL,GAAU,MAAK7B,KAAL,CAAWC,KAArB,CAA4B,CACxB4B,CAAC,CAAGF,SAAS,CAAC1B,KAAV,CAAgB4B,CAAhB,CAAJ,CACA,GAAI,CAACA,CAAC,CAACf,WAAP,CAAoB,CAChB,GAAIgB,CAAAA,WAAW,CAAG,KAAKC,OAAL,CAAaF,CAAb,CAAlB,CACA,GAAI,CAACA,CAAC,CAACd,MAAP,CAAe,CACXc,CAAC,CAACd,MAAF,CAAWpB,YAAY,CAACkC,CAAC,CAACpB,SAAH,CAAcoB,CAAC,CAAClB,CAAF,CAAIqB,OAAlB,CAA2BH,CAAC,CAACtB,OAA7B,CAAvB,CACA,GAAIuB,WAAJ,CACI,KAAKG,OAAL,CAAaJ,CAAb,EACP,CAJD,IAIO,CACHA,CAAC,CAACd,MAAF,CAASmB,MAAT,GACH,CAEDL,CAAC,CAACf,WAAF,CAAgB,IAAhB,CACH,CACJ,CACJ,C,wCAEOM,I,CAAM,CACV,GAAIU,CAAAA,WAAW,CAAG,IAAlB,CACAV,IAAI,CAACX,SAAL,CAAiBW,IAAI,CAACf,MAAtB,CACA,GAAIe,IAAI,CAACX,SAAL,GAAmB,QAAvB,CAAiC,CAC7B,KAAK0B,iBAAL,CAAuBf,IAAvB,EACAU,WAAW,CAAG,KAAd,CACH,CAED,GAAIV,IAAI,CAACb,OAAT,CAAkB,CACd,GAAIa,IAAI,CAACb,OAAL,CAAa6B,cAAb,EAA+BhB,IAAI,CAACb,OAAL,CAAa8B,WAAhD,CACI,KAAKC,kBAAL,CAAwBlB,IAAxB,EACJ,GAAIA,IAAI,CAACb,OAAL,CAAagC,WAAjB,CACI,KAAKC,iBAAL,CAAuBpB,IAAvB,EACP,CAED,MAAOU,CAAAA,WAAP,CACH,C,4DAEiBV,I,CAAM,iBACpB,GAAIqB,CAAAA,IAAI,CAAG,CAACC,KAAK,CAAE,CAAR,CAAWC,MAAM,CAAE,CAAnB,CAAsBC,GAAG,CAAE,CAA3B,CAA8BC,KAAK,CAAE,CAArC,CAAwCC,MAAM,CAAE,CAAhD,CAAmDC,IAAI,CAAE,CAAzD,CAAX,CACA3B,IAAI,CAACX,SAAL,CAAiB,CAACuC,qBAAqB,CAAE,uCAAMP,CAAAA,IAAN,EAAxB,CAAjB,CACA,KAAKQ,kBAAL,CAAwB7B,IAAxB,EAA8B8B,QAA9B,CAAuCrD,MAAM,CAACsD,UAA9C,CAA0D,cAA8B,IAAnBC,CAAAA,CAAmB,MAA5BC,OAA4B,CAAPC,CAAO,MAAhBC,OAAgB,CACpF,GAAI,CACA,GAAI,CAACnC,IAAI,CAACP,SAAV,CACI,MAAI,CAACoB,OAAL,CAAab,IAAb,EACJqB,IAAI,CAACM,IAAL,CAAYK,CAAZ,CACAX,IAAI,CAACG,GAAL,CAAWU,CAAX,CACAb,IAAI,CAACI,KAAL,CAAaJ,IAAI,CAACM,IAAL,CAAYN,IAAI,CAACC,KAA9B,CACAD,IAAI,CAACK,MAAL,CAAcL,IAAI,CAACG,GAAL,CAAWH,IAAI,CAACE,MAA9B,CACAvB,IAAI,CAACL,MAAL,CAAYmB,MAAZ,GACH,CAAC,MAAOsB,CAAP,CAAU,CACX,CACJ,CAXD,EAYH,C,8DAEkBpC,I,CAAM,iBACrB,KAAK6B,kBAAL,CAAwB7B,IAAxB,EAA8B8B,QAA9B,CAAuCrD,MAAM,CAAC4D,UAA9C,CAA0D,eAA0B,IAAjBL,CAAAA,CAAiB,OAAxBM,KAAwB,CAAPJ,CAAO,OAAdK,KAAc,CAChF,GAAI,CACA,GAAIvC,IAAI,CAACb,OAAL,CAAa6B,cAAjB,CAAiC,CAC7B,GAAIK,CAAAA,IAAI,CAAGrB,IAAI,CAACT,CAAL,CAAOqB,OAAP,CAAegB,qBAAf,EAAX,CACA,GAAII,CAAC,EAAIX,IAAI,CAACM,IAAV,EAAkBK,CAAC,EAAIX,IAAI,CAACI,KAA5B,EAAqCS,CAAC,EAAIb,IAAI,CAACG,GAA/C,EAAsDU,CAAC,EAAIb,IAAI,CAACK,MAApE,CACI1B,IAAI,CAACb,OAAL,CAAa6B,cAAb,GACP,CACD,GAAIhB,IAAI,CAACb,OAAL,CAAa8B,WAAjB,CACI,MAAI,CAACuB,IAAL,CAAUxC,IAAI,CAAChB,IAAf,EACP,CAAC,MAAOoD,CAAP,CAAU,CACRK,OAAO,CAACC,KAAR,CAAcN,CAAd,EACH,CACJ,CAZD,EAaH,C,4DAEiBpC,I,CAAM,iBACpB,KAAK6B,kBAAL,CAAwB7B,IAAxB,EAA8B8B,QAA9B,CAAuCrD,MAAM,CAACsD,UAA9C,CAA0D,eAA8B,IAAnBC,CAAAA,CAAmB,OAA5BC,OAA4B,CAAPC,CAAO,OAAhBC,OAAgB,CACpF,GAAI,CACA,GAAIQ,CAAAA,KAAK,CAAG3C,IAAI,CAACX,SAAL,CAAeuC,qBAAf,EAAZ,CACA,GAAIgB,CAAAA,KAAK,CAAG5C,IAAI,CAACT,CAAL,CAAOqB,OAAP,CAAegB,qBAAf,EAAZ,CACA,GAAI,CAAC5B,IAAI,CAAC6C,iBAAV,CAA6B,CACzB,GAAIC,CAAAA,GAAG,CAAG,CAAV,CACA9C,IAAI,CAAC6C,iBAAL,CAAyB,CAACC,GAAD,CAAMA,GAAN,CAAzB,CACA,GAAI,CACA9C,IAAI,CAAC6C,iBAAL,CAAyB7C,IAAI,CAACb,OAAL,CAAa4D,SAAb,CAAuBC,MAAvB,CAA8B,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAACjE,IAAF,GAAW,QAAf,EAA/B,EAAwD,CAAxD,EAA2DG,OAA3D,CAAmE+D,MAA5F,CACA,GAAIlD,IAAI,CAAC6C,iBAAL,CAAuB,CAAvB,IAA8B,CAAlC,CACI7C,IAAI,CAAC6C,iBAAL,CAAuB,CAAvB,EAA4BC,GAA5B,CACJ,GAAI9C,IAAI,CAAC6C,iBAAL,CAAuB,CAAvB,IAA8B,CAAlC,CACI7C,IAAI,CAAC6C,iBAAL,CAAuB,CAAvB,EAA4BC,GAA5B,CACP,CAAC,MAAOV,CAAP,CAAU,CACX,CACJ,CACD,GAAIe,CAAAA,CAAC,CAAGnD,IAAI,CAAC6C,iBAAb,CACA,GAAI,EACCb,CAAC,EAAIW,KAAK,CAAChB,IAAN,CAAawB,CAAC,CAAC,CAAD,CAAnB,EAA0BnB,CAAC,EAAIW,KAAK,CAAClB,KAAN,CAAc0B,CAAC,CAAC,CAAD,CAA9C,EAAqDjB,CAAC,EAAIS,KAAK,CAACnB,GAAN,CAAY2B,CAAC,CAAC,CAAD,CAAvE,EAA8EjB,CAAC,EAAIS,KAAK,CAACjB,MAAN,CAAeyB,CAAC,CAAC,CAAD,CAApG,EACCnB,CAAC,EAAIY,KAAK,CAACjB,IAAN,CAAawB,CAAC,CAAC,CAAD,CAAnB,EAA0BnB,CAAC,EAAIY,KAAK,CAACnB,KAAN,CAAc0B,CAAC,CAAC,CAAD,CAA9C,EAAqDjB,CAAC,EAAIU,KAAK,CAACpB,GAAN,CAAY2B,CAAC,CAAC,CAAD,CAAvE,EAA8EjB,CAAC,EAAIU,KAAK,CAAClB,MAAN,CAAeyB,CAAC,CAAC,CAAD,CAFpG,CAAJ,CAGG,CACC,MAAI,CAACX,IAAL,CAAUxC,IAAI,CAAChB,IAAf,EACH,CACJ,CAAC,MAAOoD,CAAP,CAAU,CACX,CACJ,CAzBD,EA0BH,C,8DAEkBpC,I,CAAM,CACrB,GAAI,CAACA,IAAI,CAACJ,eAAV,CACII,IAAI,CAACJ,eAAL,CAAuB,GAAIpB,CAAAA,eAAJ,EAAvB,CACJ,MAAOwB,CAAAA,IAAI,CAACJ,eAAZ,CACH,C,kEAEoBI,I,CAAM,CACvBA,IAAI,CAACJ,eAAL,CAAqBwD,UAArB,GACApD,IAAI,CAACJ,eAAL,CAAuBN,SAAvB,CACH,C,wCAEOU,I,CAAM,CACVA,IAAI,CAACT,CAAL,CAAOqB,OAAP,CAAeyC,KAAf,CAAqBC,OAArB,CAA+B,OAA/B,CACAtD,IAAI,CAACP,SAAL,CAAiB,IAAjB,CACH,C,iDAEa,CACV,GAAI8D,CAAAA,GAAG,CAAG,EAAV,CACA,GAAI9C,CAAAA,CAAJ,CACA,IAAKA,CAAL,GAAU,MAAK7B,KAAL,CAAWC,KAArB,CAA4B,CACxB4B,CAAC,CAAG,KAAK7B,KAAL,CAAWC,KAAX,CAAiB4B,CAAjB,CAAJ,CACA,GAAIA,CAAC,CAACtB,OAAF,EAAasB,CAAC,CAACtB,OAAF,CAAUqE,KAA3B,CAAkC,CAC9B,GAAIC,CAAAA,GAAG,OAAP,CACA,GAAIhD,CAAC,CAACtB,OAAF,CAAUuE,SAAd,CACID,GAAG,CAAGhD,CAAC,CAACtB,OAAF,CAAUuE,SAAhB,CACJH,GAAG,CAACI,IAAJ,cACI,aAAK,GAAG,CAAElD,CAAC,CAAClB,CAAZ,CAAe,SAAS,CAAE,gBAAkBkE,GAA5C,wBACI,YAAK,SAAS,CAAE,OAAhB,CAAyB,wBAAzB,EADJ,cAEI,YAAK,SAAS,CAAE,aAAhB,EAFJ,CAGKhD,CAAC,CAACvB,OAHP,GAAsDuB,CAAC,CAACzB,IAAxD,CADJ,EAOH,CAXD,IAWO,CACHuE,GAAG,CAACI,IAAJ,cAAS,YAAK,GAAG,CAAElD,CAAC,CAAClB,CAAZ,CAAe,SAAS,CAAE,iBAA1B,UAA2DkB,CAAC,CAACvB,OAA7D,EAAkDuB,CAAC,CAACzB,IAApD,CAAT,EACH,CACJ,CAED,MAAOuE,CAAAA,GAAP,CACH,C,uCAEQ,CACL,MAAO,MAAKK,WAAL,EAAP,CACH,C,8CAtMgB5E,I,CAAMC,M,CAAQC,O,CAASC,O,CAAS,CAC7CT,YAAY,CAACI,QAAb,CAAsB+E,IAAtB,CAA2B7E,IAA3B,CAAiCC,MAAjC,CAAyCC,OAAzC,CAAkDC,OAAlD,EACH,C,4CAEgBH,I,CAAM,CACnBN,YAAY,CAACI,QAAb,CAAsB0D,IAAtB,CAA2BxD,IAA3B,EACH,C,0BApCsBV,KAAK,CAACwF,S,EAuOjC,cAAepF,CAAAA,YAAf","sourcesContent":["import React from \"react\";\nimport {createPopper} from '@popperjs/core';\nimport {EventDispatcher, Events} from \"../tools/event-dispatcher\";\n\nclass PopupHandler extends React.Component {\n    static instance;\n\n    constructor(props) {\n        super(props);\n        this.state = {items: []};\n        PopupHandler.instance = this;\n        this.shouldUpdate = false;\n    }\n\n    /**\n     *\n     * @param name this name must be unique\n     * @param anchor element | 'cursor' | {getBoundingClientRect: ()=>{some rect}}\n     * @param content the popup jsx which you wanna show\n     * @param options popper options + the following:\n     * <p>\n     *     fields:<br>\n     *     arrow: [true | false]: to show an arrow. declare 'modifiers: [{name: 'offset', options: {offset: [5, 5],},},]' to place your content as you wish<br>\n     *     className: the css class name of yours<br>\n     *     hideOnClick: [true | false]: to hide when user clicks anywhere<br>\n     *     interactive: [true | false]: to hide when cursor moves outside automatically<br>\n     * </p>\n     * <br>\n     * <p>\n     *     methods:<br>\n     *     onHideListener: method to be called on hide<br>\n     *     onClickOutSide: method to be called on outside click<br>\n     * </p>\n     */\n    static showPopup(name, anchor, content, options) {\n        PopupHandler.instance.show(name, anchor, content, options);\n    }\n\n    static hidePopup(name) {\n        PopupHandler.instance.hide(name);\n    }\n\n    show(name, anchor, content, options) {\n        let a = this.state.items;\n        if (!a[name]) {\n            a[name] = {\n                name: name,\n                anchor: anchor,\n                reference: undefined,\n                content: content,\n                options: options,\n                r: React.createRef(),\n                isVisible: false,\n                isProcessed: false,\n                popper: undefined,\n                eventDispatcher: undefined,\n            };\n        } else {\n            let t = a[name];\n            t.anchor = anchor;\n            t.content = content;\n            t.options = options;\n            t.isProcessed = false;\n        }\n        this.setState({items: a});\n        this.shouldUpdate = true;\n    }\n\n    hide(name) {\n        if (this.state.items[name]) {\n            let temp = this.state.items;\n            let item = temp[name];\n            delete temp[name];\n\n            if (item.eventDispatcher !== undefined) {\n                this.clearEventDispatcher(item);\n            }\n\n            if (item.options && item.options.onHideListener) {\n                item.options.onHideListener();\n            }\n\n            this.shouldUpdate = true;\n            this.setState({items: temp});\n        }\n    }\n\n    shouldComponentUpdate(nextProps, nextState, nextContext) {\n        return this.shouldUpdate;\n    }\n\n    componentDidUpdate(prevProps, prevState, snapshot) {\n        let i;\n        for (i in this.state.items) {\n            i = prevState.items[i];\n            if (!i.isProcessed) {\n                let readyToShow = this.prepare(i);\n                if (!i.popper) {\n                    i.popper = createPopper(i.reference, i.r.current, i.options);\n                    if (readyToShow)\n                        this.visible(i);\n                } else {\n                    i.popper.update();\n                }\n\n                i.isProcessed = true;\n            }\n        }\n    }\n\n    prepare(item) {\n        let readyToShow = true;\n        item.reference = item.anchor;\n        if (item.reference === 'cursor') {\n            this.trackMousePointer(item);\n            readyToShow = false;\n        }\n\n        if (item.options) {\n            if (item.options.onClickOutside || item.options.hideOnClick)\n                this.handleOutsideClick(item);\n            if (item.options.interactive)\n                this.handleInteractive(item);\n        }\n\n        return readyToShow;\n    }\n\n    trackMousePointer(item) {\n        let rect = {width: 5, height: 5, top: 0, right: 5, bottom: 5, left: 0};\n        item.reference = {getBoundingClientRect: () => rect};\n        this.getEventDispatcher(item).register(Events.MOUSE_MOVE, ({clientX: x, clientY: y}) => {\n            try {\n                if (!item.isVisible)\n                    this.visible(item);\n                rect.left = x;\n                rect.top = y;\n                rect.right = rect.left + rect.width;\n                rect.bottom = rect.top + rect.height;\n                item.popper.update();\n            } catch (e) {\n            }\n        });\n    }\n\n    handleOutsideClick(item) {\n        this.getEventDispatcher(item).register(Events.MOUSE_DOWN, ({pageX: x, pageY: y}) => {\n            try {\n                if (item.options.onClickOutside) {\n                    let rect = item.r.current.getBoundingClientRect();\n                    if (x <= rect.left || x >= rect.right || y <= rect.top || y >= rect.bottom)\n                        item.options.onClickOutside();\n                }\n                if (item.options.hideOnClick)\n                    this.hide(item.name);\n            } catch (e) {\n                console.error(e);\n            }\n        });\n    }\n\n    handleInteractive(item) {\n        this.getEventDispatcher(item).register(Events.MOUSE_MOVE, ({clientX: x, clientY: y}) => {\n            try {\n                let rect1 = item.reference.getBoundingClientRect();\n                let rect2 = item.r.current.getBoundingClientRect();\n                if (!item.interactiveOffset) {\n                    let min = 2;\n                    item.interactiveOffset = [min, min];\n                    try {\n                        item.interactiveOffset = item.options.modifiers.filter(h => h.name === 'offset')[0].options.offset;\n                        if (item.interactiveOffset[0] === 0)\n                            item.interactiveOffset[0] = min;\n                        if (item.interactiveOffset[1] === 0)\n                            item.interactiveOffset[1] = min;\n                    } catch (e) {\n                    }\n                }\n                let o = item.interactiveOffset;\n                if (!(\n                    (x >= rect1.left - o[1] && x <= rect1.right + o[1] && y >= rect1.top - o[0] && y <= rect1.bottom + o[0]) ||\n                    (x >= rect2.left - o[1] && x <= rect2.right + o[1] && y >= rect2.top - o[0] && y <= rect2.bottom + o[0])\n                )) {\n                    this.hide(item.name);\n                }\n            } catch (e) {\n            }\n        });\n    }\n\n    getEventDispatcher(item) {\n        if (!item.eventDispatcher)\n            item.eventDispatcher = new EventDispatcher();\n        return item.eventDispatcher;\n    }\n\n    clearEventDispatcher(item) {\n        item.eventDispatcher.unregister();\n        item.eventDispatcher = undefined;\n    }\n\n    visible(item) {\n        item.r.current.style.display = 'block';\n        item.isVisible = true;\n    }\n\n    getItemsSJX() {\n        let arr = [];\n        let i;\n        for (i in this.state.items) {\n            i = this.state.items[i];\n            if (i.options && i.options.arrow) {\n                let cls;\n                if (i.options.className)\n                    cls = i.options.className;\n                arr.push(\n                    <div ref={i.r} className={'popup-window ' + cls} key={i.name}>\n                        <div className={'arrow'} data-popper-arrow/>\n                        <div className={'arrow-cover'}/>\n                        {i.content}\n                    </div>\n                );\n            } else {\n                arr.push(<div ref={i.r} className={'popup-container'} key={i.name}>{i.content}</div>);\n            }\n        }\n\n        return arr;\n    }\n\n    render() {\n        return this.getItemsSJX();\n    }\n}\n\nexport default PopupHandler;"]},"metadata":{},"sourceType":"module"}